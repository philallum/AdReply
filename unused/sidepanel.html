<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdReply</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        facebook: {
                            blue: '#1877f2',
                            hover: '#166fe5',
                            light: '#e7f3ff',
                            gray: '#65676b',
                            lightgray: '#f2f3f5',
                            border: '#e4e6ea'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="w-80 min-h-screen bg-gray-50 font-sans text-sm leading-relaxed text-gray-800">
    <!-- Skip link for keyboard navigation -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="adreply-container flex flex-col h-screen" role="application" aria-label="AdReply Chrome Extension">
        <header class="adreply-header bg-facebook-blue text-white px-4 py-4 flex justify-between items-center shadow-sm" role="banner">
            <h1 class="text-lg font-semibold" id="app-title">AdReply</h1>
            <div class="license-status" id="licenseStatus" role="status" aria-live="polite">
                <span class="status-badge free px-2 py-1 rounded-full text-xs font-medium bg-white bg-opacity-20" aria-label="Current license: Free tier">Free</span>
            </div>
        </header>
        
        <nav class="adreply-tabs flex bg-white border-b border-facebook-border" role="tablist" aria-label="Main navigation">
            <button class="tab-button active flex-1 px-2 py-3 text-xs font-medium text-facebook-gray border-b-2 border-transparent hover:bg-facebook-lightgray transition-all duration-200" 
                    data-tab="adverts" 
                    role="tab" 
                    aria-selected="true" 
                    aria-controls="adverts-tab" 
                    id="tab-adverts"
                    tabindex="0">Adverts</button>

            <button class="tab-button flex-1 px-2 py-3 text-xs font-medium text-facebook-gray border-b-2 border-transparent hover:bg-facebook-lightgray transition-all duration-200" 
                    data-tab="license" 
                    role="tab" 
                    aria-selected="false" 
                    aria-controls="license-tab" 
                    id="tab-license"
                    tabindex="-1">License</button>
        </nav>
        
        <main class="adreply-content flex-1 overflow-y-auto" role="main" aria-labelledby="app-title" id="main-content">
            <!-- Adverts Tab -->
            <div class="tab-content active p-4 space-y-6" id="adverts-tab" role="tabpanel" aria-labelledby="tab-adverts" tabindex="0">
                <section class="suggestions-section" aria-labelledby="suggestions-heading">
                    <h2 class="text-base font-semibold mb-3 text-gray-900" id="suggestions-heading">Comment Suggestions</h2>
                    
                    <!-- Category Selection -->
                    <div class="category-selection mb-4">
                        <label for="categorySelect" class="block text-sm font-medium text-gray-700 mb-2">
                            Business Category
                        </label>
                        <select id="categorySelect" 
                                class="w-full px-3 py-2 border border-facebook-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-facebook-blue focus:border-transparent bg-white"
                                aria-label="Select your business category to prioritize relevant templates">
                            <option value="">All Categories</option>
                            <!-- Categories will be populated by JavaScript -->
                        </select>
                        <p class="text-xs text-gray-500 mt-1">
                            Select your business category to get more relevant advertisement suggestions
                        </p>
                    </div>
                    
                    <div class="suggestions-container bg-white rounded-lg border border-facebook-border min-h-32" 
                         id="suggestionsContainer" 
                         role="region" 
                         aria-label="Comment suggestions list"
                         aria-live="polite">
                        <div class="no-suggestions p-6 text-center text-facebook-gray" role="status">
                            <div class="mb-2" aria-hidden="true">
                                <svg class="w-8 h-8 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                            </div>
                            <p class="text-sm">No suggestions available. Navigate to a Facebook group post to see relevant comment suggestions.</p>
                        </div>
                    </div>
                </section>
                
                <section class="templates-section" aria-labelledby="templates-heading">
                    <div class="section-header flex justify-between items-center mb-3">
                        <h2 class="text-base font-semibold text-gray-900" id="templates-heading">Templates</h2>
                        <div class="flex space-x-2" role="toolbar" aria-label="Template actions">
                            <div class="relative">
                                <button class="btn btn-secondary bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-md text-xs font-medium transition-colors duration-200" 
                                        id="importExportBtn"
                                        aria-label="Import or export templates"
                                        aria-haspopup="true"
                                        aria-expanded="false">
                                    <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                    </svg>
                                    Import/Export
                                </button>
                                <div class="import-export-dropdown hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-10" id="importExportDropdown">
                                    <div class="py-1">
                                        <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center" id="importAdPackBtn">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                            </svg>
                                            Import Category Pack
                                        </button>
                                        <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center" id="exportTemplatesBtn">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l3-3m0 0l-3-3m3 3H9"></path>
                                            </svg>
                                            Export Templates
                                        </button>
                                        <div class="border-t border-gray-100"></div>
                                        <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center" id="createBackupBtn">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
                                            </svg>
                                            Create Backup
                                        </button>
                                        <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center" id="restoreBackupBtn">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                            </svg>
                                            Restore Backup
                                        </button>
                                        <div class="border-t border-gray-100"></div>
                                        <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center" id="manageBackupsBtn">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            </svg>
                                            Manage Backups
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary bg-facebook-blue hover:bg-facebook-hover text-white px-3 py-2 rounded-md text-xs font-medium transition-colors duration-200" 
                                    id="addTemplateBtn"
                                    aria-label="Create a new advertisement template">
                                <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                Add Template
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search and Filter Controls -->
                    <div class="template-controls mb-3" role="search" aria-label="Template search and filters">
                        <div class="search-container">
                            <label for="templateSearch" class="sr-only">Search templates</label>
                            <svg class="search-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <input type="text" 
                                   class="search-input" 
                                   id="templateSearch" 
                                   placeholder="Search templates..."
                                   aria-label="Search templates by name, content, or keywords"
                                   autocomplete="off">
                        </div>
                        
                        <!-- Category Filter -->
                        <div class="category-filter-container mb-2">
                            <label for="templateCategoryFilter" class="block text-xs font-medium text-gray-700 mb-1">
                                Filter by Category
                            </label>
                            <select id="templateCategoryFilter" 
                                    class="w-full px-3 py-2 border border-facebook-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-facebook-blue focus:border-transparent bg-white"
                                    aria-label="Filter templates by category">
                                <option value="">All Categories</option>
                                <!-- Categories will be populated by JavaScript -->
                            </select>
                        </div>
                        
                        <div class="filter-container" id="templateFilters" role="group" aria-label="Template filters">
                            <button class="filter-button active" data-filter="all" aria-pressed="true">All</button>
                            <button class="filter-button" data-filter="recent" aria-pressed="false">Recent</button>
                            <button class="filter-button" data-filter="popular" aria-pressed="false">Popular</button>
                        </div>
                    </div>
                    
                    <div class="templates-container bg-white rounded-lg border border-facebook-border min-h-24" 
                         id="templatesContainer"
                         role="region"
                         aria-label="Templates list"
                         aria-live="polite">
                        <div class="no-templates p-6 text-center text-facebook-gray" role="status">
                            <div class="mb-2" aria-hidden="true">
                                <svg class="w-8 h-8 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <p class="text-sm">No templates created yet. Create your first template to get started.</p>
                        </div>
                    </div>
                </section>
                
                <section class="usage-statistics-section" aria-labelledby="usage-stats-heading">
                    <div class="section-header flex justify-between items-center mb-3">
                        <h2 class="text-base font-semibold text-gray-900" id="usage-stats-heading">Usage Statistics</h2>
                        <button class="btn btn-secondary bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-md text-xs font-medium transition-colors duration-200" 
                                id="refreshStatsBtn"
                                aria-label="Refresh usage statistics">
                            <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Refresh
                        </button>
                    </div>
                    
                    <div class="usage-stats-container bg-white rounded-lg border border-facebook-border" 
                         id="usageStatsContainer"
                         role="region"
                         aria-label="Usage statistics"
                         aria-live="polite">
                        <div class="no-stats p-6 text-center text-facebook-gray" role="status">
                            <div class="mb-2" aria-hidden="true">
                                <svg class="w-8 h-8 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                            <p class="text-sm">No usage data available yet. Start using templates to see statistics.</p>
                        </div>
                    </div>
                </section>
            </div>
            

            
            <!-- License Tab -->
            <div class="tab-content p-4 space-y-6" id="license-tab" role="tabpanel" aria-labelledby="tab-license" tabindex="0">
                <section class="license-section" aria-labelledby="license-heading">
                    <h2 class="text-base font-semibold mb-3 text-gray-900" id="license-heading">License Management</h2>
                    
                    <div class="current-license mb-6">
                        <h3 class="text-sm font-medium text-gray-700 mb-2">Current License</h3>
                        <div class="license-info bg-white border border-facebook-border rounded-lg p-4">
                            <div class="license-tier text-base font-semibold text-gray-900 mb-2">Free Tier</div>
                            <div class="license-features">
                                <ul class="space-y-1 text-sm text-gray-600">
                                    <li class="flex items-center">
                                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        Up to 10 templates
                                    </li>
                                    <li class="flex items-center">
                                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        Basic template matching
                                    </li>
                                    <li class="flex items-center">
                                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        Template rotation
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pro-upgrade mb-6">
                        <h3 class="text-sm font-medium text-gray-700 mb-2">Upgrade to Pro</h3>
                        <div class="bg-gradient-to-br from-green-50 to-blue-50 border border-green-200 rounded-lg p-4">
                            <div class="pro-features mb-4">
                                <ul class="space-y-1 text-sm text-gray-700">
                                    <li class="flex items-center">
                                        <svg class="w-4 h-4 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        Unlimited templates
                                    </li>
                                    <li class="flex items-center">
                                        <svg class="w-4 h-4 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        Advanced template features
                                    </li>
                                    <li class="flex items-center">
                                        <svg class="w-4 h-4 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        Enhanced template management
                                    </li>
                                    <li class="flex items-center">
                                        <svg class="w-4 h-4 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        Enhanced matching
                                    </li>
                                    <li class="flex items-center">
                                        <svg class="w-4 h-4 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        Ad Pack import/export
                                    </li>
                                </ul>
                            </div>
                            <button class="btn btn-upgrade btn-large w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-md text-sm font-medium transition-colors duration-200">
                                <svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                Upgrade to Pro
                            </button>
                        </div>
                    </div>
                    
                    <div class="license-input">
                        <h3 class="text-sm font-medium text-gray-700 mb-2">Enter License Key</h3>
                        <div class="bg-white border border-facebook-border rounded-lg p-4">
                            <div class="input-group flex gap-2">
                                <input type="text" id="licenseKey" placeholder="Enter your Pro license key" class="flex-1 px-3 py-2 border border-facebook-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-facebook-blue focus:border-transparent">
                                <button class="btn btn-primary bg-facebook-blue hover:bg-facebook-hover text-white px-4 py-2 rounded-md text-xs font-medium transition-colors duration-200" id="validateLicenseBtn">Validate</button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <!-- Template Management Modal -->
    <div class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" id="templateModal">
        <div class="modal-content bg-white rounded-lg shadow-xl max-w-md w-full max-h-96 overflow-y-auto">
            <div class="modal-header flex justify-between items-center p-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900" id="modalTitle">Add Template</h3>
                <button class="modal-close text-gray-400 hover:text-gray-600 transition-colors duration-200" onclick="closeTemplateModal()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form class="modal-body p-4 space-y-4" id="templateForm">
                <div class="form-group">
                    <label for="templateLabel" class="form-label">Template Label *</label>
                    <input type="text" id="templateLabel" class="form-input" placeholder="e.g., Garage | Exhaust offer" required>
                    <p class="text-xs text-gray-500 mt-1">A descriptive name for your template</p>
                </div>
                
                <div class="form-group">
                    <label for="templateContent" class="form-label">Template Content *</label>
                    <textarea id="templateContent" class="form-input form-textarea" rows="4" 
                              placeholder="Great build! If you need custom exhaust work, we do same-day fitting â€” {site}." required></textarea>
                    <p class="text-xs text-gray-500 mt-1">Use {site} for your website URL placeholder</p>
                </div>
                
                <div class="form-group">
                    <label for="templateKeywords" class="form-label">Keywords *</label>
                    <input type="text" id="templateKeywords" class="form-input" 
                           placeholder="exhaust, garage, fit, performance" required>
                    <p class="text-xs text-gray-500 mt-1">Comma-separated keywords for matching posts</p>
                </div>
                
                <div class="form-group">
                    <label for="templateCategory" class="form-label">Category *</label>
                    <div class="category-selection-container">
                        <select id="templateCategory" class="form-input" required>
                            <option value="">Select a category...</option>
                            <!-- Categories will be populated by JavaScript -->
                        </select>
                        <button type="button" id="createCategoryBtn" class="create-category-btn mt-2 text-sm text-facebook-blue hover:text-facebook-hover font-medium flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Create New Category
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Select or create a category for this template</p>
                </div>
                
                <div class="modal-footer flex justify-end space-x-3 pt-4 border-t border-gray-200">
                    <button type="button" class="btn-secondary px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors duration-200" onclick="closeTemplateModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn-primary bg-facebook-blue hover:bg-facebook-hover text-white px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200">
                        <span id="submitButtonText">Create Template</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" id="deleteModal">
        <div class="modal-content bg-white rounded-lg shadow-xl max-w-sm w-full">
            <div class="modal-header p-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Delete Template</h3>
            </div>
            
            <div class="modal-body p-4">
                <p class="text-sm text-gray-600 mb-4">Are you sure you want to delete this template? This action cannot be undone.</p>
                <div class="template-preview bg-gray-50 p-3 rounded border text-sm">
                    <div class="font-medium text-gray-900" id="deleteTemplateLabel"></div>
                    <div class="text-gray-600 mt-1" id="deleteTemplateContent"></div>
                </div>
            </div>
            
            <div class="modal-footer flex justify-end space-x-3 p-4 border-t border-gray-200">
                <button type="button" class="btn-secondary px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors duration-200" onclick="closeDeleteModal()">
                    Cancel
                </button>
                <button type="button" class="btn-danger bg-red-600 hover:bg-red-700 text-white px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200" onclick="confirmDeleteTemplate()">
                    Delete Template
                </button>
            </div>
        </div>
    </div>

    <!-- Import Ad Pack Modal -->
    <div class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" id="importModal">
        <div class="modal-content bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="modal-header flex justify-between items-center p-6 border-b border-gray-200">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">Import Category Pack</h3>
                    <p class="text-sm text-gray-600 mt-1">Import templates from a Category Pack JSON file</p>
                </div>
                <button class="text-gray-400 hover:text-gray-600 transition-colors" onclick="closeImportModal()">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="modal-body p-6">
                <!-- File Upload Section -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Select Category Pack File</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors" id="fileDropZone">
                        <input type="file" id="adPackFileInput" accept=".json" class="hidden">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                        </svg>
                        <p class="text-sm text-gray-600 mb-2">Drop your Category Pack JSON file here or</p>
                        <button type="button" class="text-facebook-blue hover:text-facebook-hover font-medium text-sm" onclick="document.getElementById('adPackFileInput').click()">
                            Browse Files
                        </button>
                        <p class="text-xs text-gray-500 mt-2">Supports .json files up to 10MB</p>
                    </div>
                    <div id="selectedFileName" class="hidden mt-2 text-sm text-gray-600"></div>
                </div>

                <!-- Import Options -->
                <div class="mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Import Options</h4>
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="skipDuplicates" checked class="h-4 w-4 text-facebook-blue focus:ring-facebook-blue border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">Skip duplicate templates (recommended)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="validateTemplates" checked class="h-4 w-4 text-facebook-blue focus:ring-facebook-blue border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">Validate template data before import</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="allowPrebuiltOverwrite" class="h-4 w-4 text-facebook-blue focus:ring-facebook-blue border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">Allow overwriting pre-built categories (advanced)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="updateExisting" class="h-4 w-4 text-facebook-blue focus:ring-facebook-blue border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">Update existing templates with same ID</span>
                        </label>
                    </div>
                </div>

                <!-- Preview Section (hidden initially) -->
                <div id="importPreview" class="hidden mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Import Preview</h4>
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <div id="previewStats" class="text-sm text-gray-600 mb-3"></div>
                        <div id="previewTemplates" class="max-h-40 overflow-y-auto space-y-2"></div>
                    </div>
                </div>

                <!-- Progress Section (hidden initially) -->
                <div id="importProgress" class="hidden mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Import Progress</h4>
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">Processing templates...</span>
                            <span id="progressText" class="text-sm font-medium text-gray-900">0 / 0</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="progressBar" class="bg-facebook-blue h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <div id="currentTemplate" class="text-xs text-gray-500 mt-2"></div>
                    </div>
                </div>

                <!-- Results Section (hidden initially) -->
                <div id="importResults" class="hidden">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Import Results</h4>
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <div id="resultsStats" class="text-sm mb-3"></div>
                        <div id="resultsErrors" class="hidden">
                            <h5 class="text-sm font-medium text-red-700 mb-2">Errors:</h5>
                            <div id="errorsList" class="text-sm text-red-600 space-y-1 max-h-32 overflow-y-auto"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer flex justify-between items-center p-6 border-t border-gray-200">
                <div class="text-xs text-gray-500">
                    ðŸ’¡ Tip: Category Packs from trusted sources are recommended for best results
                </div>
                <div class="flex space-x-3">
                    <button type="button" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors" onclick="closeImportModal()">
                        Cancel
                    </button>
                    <button type="button" id="startImportBtn" class="px-4 py-2 bg-facebook-blue text-white rounded-md hover:bg-facebook-hover transition-colors" disabled>
                        Import Category Pack
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Templates Modal -->
    <div class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" id="exportModal">
        <div class="modal-content bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="modal-header flex justify-between items-center p-6 border-b border-gray-200">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">Export Templates</h3>
                    <p class="text-sm text-gray-600 mt-1">Export your templates as an Ad Pack JSON file</p>
                </div>
                <button class="text-gray-400 hover:text-gray-600 transition-colors" onclick="closeExportModal()">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="modal-body p-6">
                <!-- Export Options -->
                <div class="mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Export Options</h4>
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="radio" name="exportType" value="all" checked class="h-4 w-4 text-facebook-blue focus:ring-facebook-blue border-gray-300">
                            <span class="ml-2 text-sm text-gray-700">Export all templates</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="exportType" value="selected" class="h-4 w-4 text-facebook-blue focus:ring-facebook-blue border-gray-300">
                            <span class="ml-2 text-sm text-gray-700">Export selected templates</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="exportType" value="category" class="h-4 w-4 text-facebook-blue focus:ring-facebook-blue border-gray-300">
                            <span class="ml-2 text-sm text-gray-700">Export category as Category Pack</span>
                        </label>
                    </div>
                </div>

                <!-- Template Selection (hidden initially) -->
                <div id="templateSelection" class="hidden mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Select Templates</h4>
                    <div class="border border-gray-200 rounded-lg max-h-60 overflow-y-auto">
                        <div id="exportTemplateList" class="divide-y divide-gray-100">
                            <!-- Template list will be populated here -->
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-xs text-gray-500" id="selectionCount">0 templates selected</span>
                        <div class="space-x-2">
                            <button type="button" class="text-xs text-facebook-blue hover:text-facebook-hover font-medium" onclick="selectAllExportTemplates()">
                                Select All
                            </button>
                            <button type="button" class="text-xs text-gray-600 hover:text-gray-700 font-medium" onclick="deselectAllExportTemplates()">
                                Deselect All
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Category Selection (hidden initially) -->
                <div id="categorySelection" class="hidden mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Select Category to Export</h4>
                    <div class="space-y-3">
                        <select id="exportCategorySelect" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-facebook-blue focus:border-transparent">
                            <option value="">Select a category...</option>
                            <!-- Categories will be populated here -->
                        </select>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="excludePrebuiltTemplates" class="h-4 w-4 text-facebook-blue focus:ring-facebook-blue border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Exclude pre-built templates (export custom only)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="removeInternalFields" checked class="h-4 w-4 text-facebook-blue focus:ring-facebook-blue border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Remove internal fields (usage counts, timestamps)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Export Metadata -->
                <div class="mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Export Metadata</h4>
                    <div class="space-y-3">
                        <div>
                            <label for="exportTitle" class="block text-sm font-medium text-gray-700 mb-1">Category Pack Title</label>
                            <input type="text" id="exportTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-facebook-blue focus:border-transparent" placeholder="My Custom Category Pack">
                        </div>
                        <div>
                            <label for="exportDescription" class="block text-sm font-medium text-gray-700 mb-1">Description (Optional)</label>
                            <textarea id="exportDescription" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-facebook-blue focus:border-transparent resize-none" rows="2" placeholder="Description of this Category Pack..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Export Preview -->
                <div id="exportPreview" class="mb-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Export Preview</h4>
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <div id="exportStats" class="text-sm text-gray-600"></div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer flex justify-between items-center p-6 border-t border-gray-200">
                <div class="text-xs text-gray-500">
                    ðŸ’¡ Category Packs can be shared with other AdReply users
                </div>
                <div class="flex space-x-3">
                    <button type="button" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors" onclick="closeExportModal()">
                        Cancel
                    </button>
                    <button type="button" id="startExportBtn" class="px-4 py-2 bg-facebook-blue text-white rounded-md hover:bg-facebook-hover transition-colors">
                        Export Templates
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Category Modal -->
    <div class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" id="createCategoryModal">
        <div class="modal-content bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="modal-header flex justify-between items-center p-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Create New Category</h3>
                <button class="modal-close text-gray-400 hover:text-gray-600 transition-colors duration-200" onclick="closeCategoryModal()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form class="modal-body p-4 space-y-4" id="categoryForm">
                <div class="form-group">
                    <label for="categoryName" class="form-label">Category Name *</label>
                    <input type="text" id="categoryName" class="form-input" placeholder="e.g., Automotive Services" required>
                    <p class="text-xs text-gray-500 mt-1">A descriptive name for the category</p>
                </div>
                
                <div class="form-group">
                    <label for="categoryDescription" class="form-label">Description</label>
                    <textarea id="categoryDescription" class="form-input form-textarea" rows="3" 
                              placeholder="Brief description of what templates in this category are for..."></textarea>
                    <p class="text-xs text-gray-500 mt-1">Optional description to help identify the category</p>
                </div>
                
                <div class="modal-footer flex justify-end space-x-3 pt-4 border-t border-gray-200">
                    <button type="button" class="btn-secondary px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors duration-200" onclick="closeCategoryModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn-primary bg-facebook-blue hover:bg-facebook-hover text-white px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200">
                        Create Category
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Hidden file input for restore -->
    <input type="file" id="restoreFileInput" accept=".json" class="hidden">
    
    <script src="../scripts/error-handler.js"></script>
    <script src="../scripts/logger.js"></script>
    <script src="../scripts/license-utils.js"></script>
    <script src="../storage/data-models.js"></script>
    <script src="../storage/indexeddb-manager.js"></script>
    <script src="../storage/chrome-storage-manager.js"></script>
    <script src="../storage/storage-manager.js"></script>
    <script src="../storage/category-manager.js"></script>
    <script src="../storage/category-pack-manager.js"></script>
    <script src="category-functionality.js"></script>
    <script src="category-pack-functionality.js"></script>
    <script src="sidepanel.js"></script>
</body>
</html>